{"pageProps":{"slug":"tao-mot-google-chrome-extension-voi-react","title":"Tạo một Google Chrome Extension với React","date":"Wed Mar 23 2022 15:06:22 GMT+0700 (Indochina Time)","description":"Hướng dẫn viết một Extension trên Chrome với React.","tags":["Reactjs","Extension"],"content":"<h1>Tạo một Google Chrome Extension với React</h1>\n<h1>Extension cơ bản</h1>\n<p>Bạn có thể tham khảo bài viết này của mình:</p>\n<ul>\n<li><a href=\"https://hungkieu.dev\">Hướng dẫn viết một Extension trên Chrome</a></li>\n</ul>\n<p>Với việc extension được viết bằng JS, thì bạn hoàn toàn có thể sử dụng các thư viện hay framework JS để phát triển một extension cho mình. Trong bài viết này mình sẽ tạo một extension với ReactJS.</p>\n<h1>Khởi Tạo React App</h1>\n<p>Mình sẽ sử dụng <code>create-react-app</code> CLI command:</p>\n<pre><code class=\"hljs language-bash\">npx create-react-app my-extension\n</code></pre>\n<p><img src=\"https://images.viblo.asia/199d16d0-6640-4b2f-abba-4e1dc5fb0f7f.png\" alt=\"\"></p>\n<h1>Manifest.json</h1>\n<p>Bước đầu thì mình sẽ sửa lại file manifest.json ở thư mục public, mình cũng sẽ sử dụng Manifest v3 luôn thử:</p>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-punctuation\">{</span>\n  <span class=\"hljs-attr\">\"manifest_version\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-number\">3</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"name\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"Pull Requests Tracker\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"description\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"Pull Requests Tracker\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"version\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"1.0\"</span><span class=\"hljs-punctuation\">,</span>\n  <span class=\"hljs-attr\">\"action\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"default_popup\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"index.html\"</span><span class=\"hljs-punctuation\">,</span>\n    <span class=\"hljs-attr\">\"default_title\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"Open tracker\"</span>\n  <span class=\"hljs-punctuation\">}</span>\n<span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p><code>default_popup</code> để chỉ file file html mà mình dùng cho poup của extension. Sau khi sửa lại file manifest.json mình sẽ chạy <code>yarn run build</code> để chạy thử. Thư mục <code>/build</code> lúc này là folder chứa extension của chúng ta.</p>\n<p>Để thêm extension vào trình duyệt, thì mình tạo thêm một file <code>.env</code> để không bị lỗi <a href=\"https://developer.chrome.com/docs/apps/contentSecurityPolicy/\">CSP (tham khảo)</a></p>\n<pre><code class=\"hljs language-bash\">INLINE_RUNTIME_CHUNK=<span class=\"hljs-literal\">false</span>\n</code></pre>\n<p>Giờ thì mình có thể thêm vào trình duyệt</p>\n<p><img src=\"https://images.viblo.asia/a6dd9a0a-9aa8-4ade-ac4d-b0fda78a8126.png\" alt=\"\"></p>\n<h1>Popup</h1>\n<p>Ở bước này thì mình chỉ code React thôi. Extension mình định tạo thì có chức năng hiển thị lại các pull mình đang có, giống như bookmark vậy, nhưng thêm tự động khi mình mở pull.</p>\n<p><img src=\"https://images.viblo.asia/08cccf8e-b692-4aec-903e-9f2068373125.png\" alt=\"\"></p>\n<p>Mình sẽ giải thích luồng hoạt động như sau:</p>\n<ul>\n<li>Khi mình mở một pull request bất kỳ và có url dạng <code>https://github.com/owner/repo/pull/xxx</code></li>\n<li>Kiểm tra tên người tạo pull</li>\n<li>Lấy thông tin pull</li>\n<li>Kiểm tra và lưu vào store</li>\n<li>Sau khi pull được merge thì xoá khỏi store vào ngày hôm sau</li>\n</ul>\n<h1>Craco</h1>\n<p>Craco (Create react app configuration override) một packge giúp bạn chỉnh sửa config của create-react-app một cách dễ dàng.\nMình sẽ cài đặt package này để config build cho các file script của extension.</p>\n<pre><code class=\"hljs language-bash\">yarn add @craco/craco\n</code></pre>\n<p>Tạo file <code>craco.config.js</code></p>\n<pre><code class=\"hljs language-js\"><span class=\"hljs-variable hljs-language\">module</span>.<span class=\"hljs-property\">exports</span> = {\n  <span class=\"hljs-attr\">webpack</span>: {\n    <span class=\"hljs-attr\">configure</span>: <span class=\"hljs-function\">(<span class=\"hljs-params\">webpackConfig, { env, paths }</span>) =></span> {\n      <span class=\"hljs-keyword\">return</span> {\n        ...webpackConfig,\n        <span class=\"hljs-attr\">entry</span>: {\n          <span class=\"hljs-attr\">main</span>: [\n            env === <span class=\"hljs-string\">\"development\"</span> &#x26;&#x26;\n              <span class=\"hljs-built_in\">require</span>.<span class=\"hljs-title hljs-function\">resolve</span>(<span class=\"hljs-string\">\"react-dev-utils/webpackHotDevClient\"</span>),\n            paths.<span class=\"hljs-property\">appIndexJs</span>,\n          ].<span class=\"hljs-title hljs-function\">filter</span>(<span class=\"hljs-title hljs-class\">Boolean</span>),\n          <span class=\"hljs-attr\">background</span>: <span class=\"hljs-string\">\"./src/chrome/background.js\"</span>,\n          <span class=\"hljs-attr\">contentScript</span>: <span class=\"hljs-string\">\"./src/chrome/contentScript.js\"</span>,\n        },\n        <span class=\"hljs-attr\">output</span>: {\n          ...webpackConfig.<span class=\"hljs-property\">output</span>,\n          <span class=\"hljs-attr\">filename</span>: <span class=\"hljs-string\">\"[name].js\"</span>,\n        },\n        <span class=\"hljs-attr\">optimization</span>: {\n          ...webpackConfig.<span class=\"hljs-property\">optimization</span>,\n          <span class=\"hljs-attr\">runtimeChunk</span>: <span class=\"hljs-literal\">false</span>,\n        },\n      };\n    },\n  },\n};\n</code></pre>\n<p>Giờ thì phải tạo thêm hai file <code>src/chrome/background.js</code> và <code>src/chrome/contentScript.js</code></p>\n<h1>Content Script</h1>\n<p>File content script này mình sẽ để chạy mỗi khi vào github. Để sử dụng thì cần cập nhật thêm vào file Manifest.json</p>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-attr\">\"content_scripts\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n    <span class=\"hljs-punctuation\">{</span>\n      <span class=\"hljs-attr\">\"matches\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">\"https://github.com/*\"</span><span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n      <span class=\"hljs-attr\">\"js\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span><span class=\"hljs-string\">\"contentScript.js\"</span><span class=\"hljs-punctuation\">]</span>\n    <span class=\"hljs-punctuation\">}</span>\n  <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n</code></pre>\n<p>Ở file này mình sẽ check khi người dùng mở một pull request bất kỳ, và lấy dữ liệu mình cần rồi dùng <code>chrome.runtime.sendMessage</code> để gửi đến background script của extension. Thông tin mình cần thì nó dạng:</p>\n<pre><code class=\"hljs language-js\">{\n    <span class=\"hljs-attr\">title</span>: <span class=\"hljs-string\">'Add unstable prefix in React.js instead of entry points'</span>,\n    <span class=\"hljs-attr\">status</span>: <span class=\"hljs-string\">'Open'</span>,\n    <span class=\"hljs-attr\">pathname</span>: <span class=\"hljs-string\">'/facebook/react/pull/21722'</span>,\n    <span class=\"hljs-attr\">updated_at</span>: <span class=\"hljs-number\">22</span>,\n    <span class=\"hljs-attr\">nameActive</span>: <span class=\"hljs-string\">'acdlite'</span>\n}\n</code></pre>\n<h1>Background Script</h1>\n<p>Đây là phần script mà nó sẽ chạy ngầm liên tục khi mình cài extension vào trình duyệt. Vì vậy nên mới có thể sử dụng để nhận thông tin bất kỳ lúc nào mà không cần mở popup. Mình sẽ cập nhật thêm vào Manifest.json</p>\n<pre><code class=\"hljs language-json\"><span class=\"hljs-attr\">\"permissions\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">[</span>\n    <span class=\"hljs-string\">\"storage\"</span>\n  <span class=\"hljs-punctuation\">]</span><span class=\"hljs-punctuation\">,</span>\n  ...\n  <span class=\"hljs-attr\">\"background\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-punctuation\">{</span>\n    <span class=\"hljs-attr\">\"service_worker\"</span><span class=\"hljs-punctuation\">:</span> <span class=\"hljs-string\">\"background.js\"</span>\n  <span class=\"hljs-punctuation\">}</span>\n</code></pre>\n<p>Mình có thêm <code>\"permissions: ['storage']\"</code> vì ở đây mình sẽ cần <code>chrome.storage</code> để lưu thông tin pull.</p>\n<h1>Demo</h1>\n<p>Đến bước này thì mình hoàn thành cơ bản được rồi</p>\n<p><img src=\"https://images.viblo.asia/b7a3d191-dcd8-4c59-af90-d4621e28b61d.gif\" alt=\"\"></p>\n<p>Trong bài viết thì mình không muốn coppy phần code vào, bạn có thể tham khảo</p>\n<p>Source code: <a href=\"https://github.com/muoihai-com/pull-requests-tracker\">https://github.com/muoihai-com/pull-requests-tracker</a></p>\n<p><img src=\"https://images.viblo.asia/21255719-39d7-4787-bb59-7606744a0c9e.png\" alt=\"\"></p>"},"__N_SSG":true}